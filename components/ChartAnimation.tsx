"use client";

import { animate, useInView } from "framer-motion";
import { useEffect, useRef } from "react";

export default function ChartAnimation() {
  const ref = useRef<SVGSVGElement>(null);
  const isInView = useInView(ref, { once: true, margin: "-100px" });

  const path1Ref = useRef<SVGPathElement>(null);
  const path2Ref = useRef<SVGPathElement>(null);
  const circle1Ref = useRef<SVGGElement>(null);
  const circle2Ref = useRef<SVGGElement>(null);

  const path1d =
    "M5 165L36.3033 163.074C36.9758 163.032 37.5 162.475 37.5 161.801V161.801C37.5 161.603 37.5461 161.408 37.6346 161.231L37.9428 160.614C38.599 159.302 39.8937 158.428 41.3564 158.31L95.3927 153.948C97.224 153.8 98.7661 152.52 99.2487 150.748V150.748C99.7326 148.97 101.281 147.689 103.118 147.546L200.605 139.978C204.548 139.672 207.676 136.529 207.964 132.584L208.577 124.192C208.863 120.272 211.955 117.14 215.871 116.804L225.491 115.978C226.837 115.863 227.87 114.736 227.87 113.386V113.386C227.87 112.008 228.944 110.869 230.32 110.788L336.664 104.552C337.524 104.502 338.371 104.313 339.171 103.992L343.753 102.156C346.743 100.958 348.704 98.0604 348.704 94.8389V94.8389C348.704 90.6061 352.047 87.1289 356.276 86.9625L451.707 83.2079C454.916 83.0817 457.738 81.0488 458.875 78.0452L462.044 69.6685C463.221 66.5577 466.2 64.4997 469.527 64.4997H509.478C512.802 64.4997 515.78 62.4446 516.958 59.3369L518.801 54.4778C519.847 51.7206 522.325 49.7623 525.249 49.3819L582 42";
  const path2d =
    "M5 165L37.5 163V163C37.8237 163 38.1377 162.89 38.3904 162.688L39.2765 161.979C40.0703 161.344 41.05 160.986 42.0663 160.959L95.8673 159.556C97.1564 159.522 98.2963 158.71 98.7491 157.502V157.502C99.2028 156.293 100.346 155.48 101.638 155.449L200.626 153.092C202.78 153.041 204.5 151.28 204.5 149.124V149.124C204.5 147.072 206.065 145.358 208.11 145.172L222.836 143.833C224.911 143.644 226.5 141.905 226.5 139.821V139.821C226.5 137.679 228.177 135.911 230.316 135.798L335.627 130.231C338.274 130.091 340.575 128.37 341.458 125.87V125.87C342.382 123.251 344.857 121.5 347.634 121.5H351L449.927 119.11C452.68 119.044 455.106 117.283 456.023 114.686V114.686C456.917 112.153 459.25 110.409 461.933 110.269L510.549 107.732C513.243 107.592 515.586 105.841 516.484 103.297V103.297C517.398 100.706 519.808 98.9429 522.554 98.8558L581 97.0003";

  useEffect(() => {
    const circle1 = circle1Ref.current;
    const circle2 = circle2Ref.current;
    const path1 = path1Ref.current;
    const path2 = path2Ref.current;

    if (!isInView || !circle1 || !circle2 || !path1 || !path2) {
      return;
    }

    circle1.style.offsetPath = `path('${path1d}')`;
    circle2.style.offsetPath = `path('${path2d}')`;

    // Set initial position to the left end of the path
    circle1.style.offsetDistance = "0%";
    circle2.style.offsetDistance = "0%";

    // Animate to 100% of the path length instead of stopping at a specific point
    animate(0, 100, {
      duration: 4, // Slower animation
      ease: "easeInOut",
      onUpdate: (latest) => {
        if (circle1) {
          circle1.style.offsetDistance = `${latest}%`;
        }
      },
    });

    animate(0, 100, {
      duration: 4, // Slower animation
      ease: "easeInOut",
      onUpdate: (latest) => {
        if (circle2) {
          circle2.style.offsetDistance = `${latest}%`;
        }
      },
    });
  }, [isInView, path1d, path2d]);

  return (
    <svg
      ref={ref}
      viewBox="0 0 595 169"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
      className="h-[169px] w-full"
    >
      <g clipPath="url(#clip0_1109_720)">
        <rect width="595" height="169" rx="10.8972" fill="#142130" />
        <line
          x1="1.34056"
          y1="61.2093"
          x2="580.659"
          y2="61.2093"
          stroke="#20344B"
          strokeWidth="0.681115"
          strokeLinecap="round"
        />
        <line
          x1="1.34056"
          y1="96.7882"
          x2="580.659"
          y2="96.7882"
          stroke="#20344B"
          strokeWidth="0.681115"
          strokeLinecap="round"
        />
        <line
          x1="1.34056"
          y1="132.367"
          x2="580.659"
          y2="132.367"
          stroke="#20344B"
          strokeWidth="0.681115"
          strokeLinecap="round"
        />
        <line
          x1="1.34056"
          y1="167.946"
          x2="580.659"
          y2="167.946"
          stroke="#20344B"
          strokeWidth="0.681115"
          strokeLinecap="round"
        />
        <path
          ref={path1Ref}
          d={path1d}
          stroke="#4184AE"
          strokeWidth="1.5"
          strokeLinecap="round"
          strokeLinejoin="round"
        />
        <path
          ref={path2Ref}
          d={path2d}
          stroke="#FF9294"
          strokeWidth="1.5"
          strokeLinecap="round"
          strokeLinejoin="round"
        />
        <g ref={circle1Ref}>
          <circle opacity="0.32" r="9" fill="#4893C1" />
          <circle r="5" fill="#4893C1" />
        </g>
        <g ref={circle2Ref}>
          <circle opacity="0.32" r="9" fill="#FF9294" />
          <circle r="5" fill="#FF9294" />
        </g>
        <rect
          x="3"
          y="3.07703"
          width="137"
          height="19"
          rx="9.5"
          fill="url(#paint0_linear_1109_720)"
        />
        <rect
          x="3"
          y="30.077"
          width="65"
          height="13"
          rx="6.5"
          fill="url(#paint1_linear_1109_720)"
        />
        <circle cx="461.498" cy="16.5" r="4" fill="#4893C1" />
        <path
          d="M479.668 16.6364C479.668 17.5568 479.501 18.3523 479.169 19.0227C478.837 19.6932 478.381 20.2102 477.801 20.5739C477.222 20.9375 476.56 21.1193 475.815 21.1193C475.071 21.1193 474.409 20.9375 473.829 20.5739C473.25 20.2102 472.794 19.6932 472.462 19.0227C472.129 18.3523 471.963 17.5568 471.963 16.6364C471.963 15.7159 472.129 14.9205 472.462 14.25C472.794 13.5795 473.25 13.0625 473.829 12.6989C474.409 12.3352 475.071 12.1534 475.815 12.1534C476.56 12.1534 477.222 12.3352 477.801 12.6989C478.381 13.0625 478.837 13.5795 479.169 14.25C479.501 14.9205 479.668 15.7159 479.668 16.6364ZM478.645 16.6364C478.645 15.8807 478.518 15.2429 478.266 14.723C478.016 14.2031 477.676 13.8097 477.247 13.5426C476.821 13.2756 476.344 13.142 475.815 13.142C475.287 13.142 474.808 13.2756 474.379 13.5426C473.953 13.8097 473.614 14.2031 473.361 14.723C473.111 15.2429 472.986 15.8807 472.986 16.6364C472.986 17.392 473.111 18.0298 473.361 18.5497C473.614 19.0696 473.953 19.4631 474.379 19.7301C474.808 19.9972 475.287 20.1307 475.815 20.1307C476.344 20.1307 476.821 19.9972 477.247 19.7301C477.676 19.4631 478.016 19.0696 478.266 18.5497C478.518 18.0298 478.645 17.392 478.645 16.6364ZM481.308 23.4545V14.4545H482.28V15.4943H482.399C482.473 15.3807 482.575 15.2358 482.706 15.0597C482.839 14.8807 483.03 14.7216 483.277 14.5824C483.527 14.4403 483.865 14.3693 484.291 14.3693C484.842 14.3693 485.328 14.5071 485.748 14.7827C486.169 15.0582 486.497 15.4489 486.733 15.9545C486.969 16.4602 487.087 17.0568 487.087 17.7443C487.087 18.4375 486.969 19.0384 486.733 19.5469C486.497 20.0526 486.17 20.4446 485.753 20.723C485.335 20.9986 484.854 21.1364 484.308 21.1364C483.888 21.1364 483.551 21.0668 483.298 20.9276C483.045 20.7855 482.851 20.625 482.714 20.446C482.578 20.2642 482.473 20.1136 482.399 19.9943H482.314V23.4545H481.308ZM482.297 17.7273C482.297 18.2216 482.369 18.6577 482.514 19.0355C482.659 19.4105 482.871 19.7045 483.149 19.9176C483.427 20.1278 483.768 20.233 484.172 20.233C484.592 20.233 484.943 20.1222 485.224 19.9006C485.508 19.6761 485.722 19.375 485.864 18.9972C486.008 18.6165 486.081 18.1932 486.081 17.7273C486.081 17.267 486.01 16.8523 485.868 16.483C485.729 16.1108 485.517 15.8168 485.233 15.6009C484.952 15.3821 484.598 15.2727 484.172 15.2727C483.763 15.2727 483.419 15.3764 483.141 15.5838C482.862 15.7884 482.652 16.0753 482.51 16.4446C482.368 16.8111 482.297 17.2386 482.297 17.7273ZM491.467 14.4545V15.3068H488.075V14.4545H491.467ZM489.064 12.8864H490.07V19.125C490.07 19.4091 490.111 19.6222 490.193 19.7642C490.278 19.9034 490.386 19.9972 490.517 20.0455C490.65 20.0909 490.791 20.1136 490.939 20.1136C491.05 20.1136 491.141 20.108 491.212 20.0966C491.283 20.0824 491.339 20.071 491.382 20.0625L491.587 20.9659C491.518 20.9915 491.423 21.017 491.301 21.0426C491.179 21.071 491.024 21.0852 490.837 21.0852C490.552 21.0852 490.274 21.0241 490.001 20.902C489.731 20.7798 489.507 20.5938 489.328 20.3438C489.152 20.0938 489.064 19.7784 489.064 19.3977V12.8864ZM492.98 21V14.4545H493.986V21H492.98ZM493.491 13.3636C493.295 13.3636 493.126 13.2969 492.984 13.1634C492.845 13.0298 492.775 12.8693 492.775 12.6818C492.775 12.4943 492.845 12.3338 492.984 12.2003C493.126 12.0668 493.295 12 493.491 12C493.687 12 493.855 12.0668 493.994 12.2003C494.136 12.3338 494.207 12.4943 494.207 12.6818C494.207 12.8693 494.136 13.0298 493.994 13.1634C493.855 13.2969 493.687 13.3636 493.491 13.3636ZM501.93 15C501.836 14.7131 501.713 14.456 501.559 14.2287C501.409 13.9986 501.228 13.8026 501.018 13.6406C500.811 13.4787 500.575 13.3551 500.311 13.2699C500.046 13.1847 499.757 13.142 499.441 13.142C498.924 13.142 498.454 13.2756 498.031 13.5426C497.608 13.8097 497.271 14.2031 497.021 14.723C496.771 15.2429 496.646 15.8807 496.646 16.6364C496.646 17.392 496.772 18.0298 497.025 18.5497C497.278 19.0696 497.62 19.4631 498.052 19.7301C498.484 19.9972 498.97 20.1307 499.509 20.1307C500.009 20.1307 500.45 20.0241 500.831 19.8111C501.214 19.5952 501.512 19.2912 501.725 18.8991C501.941 18.5043 502.049 18.0398 502.049 17.5057L502.373 17.5739H499.748V16.6364H503.072V17.5739C503.072 18.2926 502.919 18.9176 502.612 19.4489C502.308 19.9801 501.887 20.392 501.35 20.6847C500.816 20.9744 500.203 21.1193 499.509 21.1193C498.737 21.1193 498.058 20.9375 497.473 20.5739C496.89 20.2102 496.436 19.6932 496.109 19.0227C495.785 18.3523 495.623 17.5568 495.623 16.6364C495.623 15.946 495.715 15.3253 495.9 14.7741C496.088 14.2202 496.352 13.7486 496.693 13.3594C497.034 12.9702 497.437 12.6719 497.903 12.4645C498.369 12.2571 498.882 12.1534 499.441 12.1534C499.902 12.1534 500.331 12.223 500.728 12.3622C501.129 12.4986 501.485 12.6932 501.798 12.946C502.113 13.196 502.376 13.4957 502.586 13.8452C502.796 14.1918 502.941 14.5767 503.021 15H501.93ZM504.746 21V14.4545H505.717V15.4432H505.785C505.905 15.1193 506.121 14.8565 506.433 14.6548C506.746 14.4531 507.098 14.3523 507.49 14.3523C507.564 14.3523 507.656 14.3537 507.767 14.3565C507.878 14.3594 507.962 14.3636 508.018 14.3693V15.392C507.984 15.3835 507.906 15.3707 507.784 15.3537C507.665 15.3338 507.538 15.3239 507.405 15.3239C507.087 15.3239 506.802 15.3906 506.552 15.5241C506.305 15.6548 506.109 15.8366 505.964 16.0696C505.822 16.2997 505.751 16.5625 505.751 16.858V21H504.746ZM509.21 21V14.4545H510.216V21H509.21ZM509.722 13.3636C509.526 13.3636 509.357 13.2969 509.215 13.1634C509.076 13.0298 509.006 12.8693 509.006 12.6818C509.006 12.4943 509.076 12.3338 509.215 12.2003C509.357 12.0668 509.526 12 509.722 12C509.918 12 510.085 12.0668 510.225 12.2003C510.367 12.3338 510.438 12.4943 510.438 12.6818C510.438 12.8693 510.367 13.0298 510.225 13.1634C510.085 13.2969 509.918 13.3636 509.722 13.3636ZM514.53 21.1364C513.984 21.1364 513.503 20.9986 513.085 20.723C512.668 20.4446 512.341 20.0526 512.105 19.5469C511.869 19.0384 511.751 18.4375 511.751 17.7443C511.751 17.0568 511.869 16.4602 512.105 15.9545C512.341 15.4489 512.669 15.0582 513.089 14.7827C513.51 14.5071 513.996 14.3693 514.547 14.3693C514.973 14.3693 515.31 14.4403 515.557 14.5824C515.807 14.7216 515.997 14.8807 516.128 15.0597C516.261 15.2358 516.365 15.3807 516.439 15.4943H516.524V12.2727H517.53V21H516.558V19.9943H516.439C516.365 20.1136 516.26 20.2642 516.123 20.446C515.987 20.625 515.793 20.7855 515.54 20.9276C515.287 21.0668 514.95 21.1364 514.53 21.1364ZM514.666 20.233C515.07 20.233 515.41 20.1278 515.689 19.9176C515.967 19.7045 516.179 19.4105 516.324 19.0355C516.469 18.6577 516.541 18.2216 516.541 17.7273C516.541 17.2386 516.47 16.8111 516.328 16.4446C516.186 16.0753 515.976 15.7884 515.697 15.5838C515.419 15.3764 515.075 15.2727 514.666 15.2727C514.24 15.2727 513.885 15.3821 513.601 15.6009C513.32 15.8168 513.108 16.1108 512.966 16.483C512.827 16.8523 512.757 17.267 512.757 17.7273C512.757 18.1932 512.828 18.6165 512.97 18.9972C513.115 19.375 513.328 19.6761 513.609 19.9006C513.893 20.1222 514.246 20.233 514.666 20.233Z"
          fill="white"
        />
        <circle cx="532.589" cy="16.5" r="4" fill="#FF9294" />
        <path
          d="M550.758 16.6364C550.758 17.5568 550.592 18.3523 550.26 19.0227C549.927 19.6932 549.471 20.2102 548.892 20.5739C548.312 20.9375 547.65 21.1193 546.906 21.1193C546.162 21.1193 545.5 20.9375 544.92 20.5739C544.341 20.2102 543.885 19.6932 543.552 19.0227C543.22 18.3523 543.054 17.5568 543.054 16.6364C543.054 15.7159 543.22 14.9205 543.552 14.25C543.885 13.5795 544.341 13.0625 544.92 12.6989C545.5 12.3352 546.162 12.1534 546.906 12.1534C547.65 12.1534 548.312 12.3352 548.892 12.6989C549.471 13.0625 549.927 13.5795 550.26 14.25C550.592 14.9205 550.758 15.7159 550.758 16.6364ZM549.736 16.6364C549.736 15.8807 549.609 15.2429 549.356 14.723C549.106 14.2031 548.767 13.8097 548.338 13.5426C547.912 13.2756 547.434 13.142 546.906 13.142C546.378 13.142 545.899 13.2756 545.47 13.5426C545.044 13.8097 544.704 14.2031 544.452 14.723C544.202 15.2429 544.077 15.8807 544.077 16.6364C544.077 17.392 544.202 18.0298 544.452 18.5497C544.704 19.0696 545.044 19.4631 545.47 19.7301C545.899 19.9972 546.378 20.1307 546.906 20.1307C547.434 20.1307 547.912 19.9972 548.338 19.7301C548.767 19.4631 549.106 19.0696 549.356 18.5497C549.609 18.0298 549.736 17.392 549.736 16.6364ZM555.246 14.4545V15.3068H551.854V14.4545H555.246ZM552.842 12.8864H553.848V19.125C553.848 19.4091 553.889 19.6222 553.971 19.7642C554.057 19.9034 554.165 19.9972 554.295 20.0455C554.429 20.0909 554.569 20.1136 554.717 20.1136C554.828 20.1136 554.919 20.108 554.99 20.0966C555.061 20.0824 555.118 20.071 555.16 20.0625L555.365 20.9659C555.297 20.9915 555.202 21.017 555.079 21.0426C554.957 21.071 554.802 21.0852 554.615 21.0852C554.331 21.0852 554.052 21.0241 553.78 20.902C553.51 20.7798 553.285 20.5938 553.106 20.3438C552.93 20.0938 552.842 19.7784 552.842 19.3977V12.8864ZM557.905 17.0625V21H556.899V12.2727H557.905V15.4773H557.99C558.143 15.1392 558.373 14.8707 558.68 14.6719C558.99 14.4702 559.402 14.3693 559.916 14.3693C560.362 14.3693 560.753 14.4588 561.088 14.6378C561.423 14.8139 561.683 15.0852 561.868 15.4517C562.055 15.8153 562.149 16.2784 562.149 16.8409V21H561.143V16.9091C561.143 16.3892 561.008 15.9872 560.738 15.7031C560.471 15.4162 560.101 15.2727 559.626 15.2727C559.297 15.2727 559.001 15.3423 558.74 15.4815C558.481 15.6207 558.277 15.8239 558.126 16.0909C557.979 16.358 557.905 16.6818 557.905 17.0625ZM566.733 21.1364C566.102 21.1364 565.558 20.9972 565.101 20.7188C564.646 20.4375 564.296 20.0455 564.048 19.5426C563.804 19.0369 563.682 18.4489 563.682 17.7784C563.682 17.108 563.804 16.517 564.048 16.0057C564.296 15.4915 564.639 15.0909 565.08 14.804C565.523 14.5142 566.04 14.3693 566.631 14.3693C566.972 14.3693 567.308 14.4261 567.641 14.5398C567.973 14.6534 568.276 14.8381 568.548 15.0938C568.821 15.3466 569.039 15.6818 569.2 16.0994C569.362 16.517 569.443 17.0312 569.443 17.642V18.0682H564.398V17.1989H568.421C568.421 16.8295 568.347 16.5 568.199 16.2102C568.054 15.9205 567.847 15.6918 567.577 15.5241C567.31 15.3565 566.994 15.2727 566.631 15.2727C566.23 15.2727 565.884 15.3722 565.591 15.571C565.301 15.767 565.078 16.0227 564.922 16.3381C564.766 16.6534 564.688 16.9915 564.688 17.3523V17.9318C564.688 18.4261 564.773 18.8452 564.943 19.1889C565.117 19.5298 565.357 19.7898 565.664 19.9688C565.97 20.1449 566.327 20.233 566.733 20.233C566.997 20.233 567.236 20.196 567.449 20.1222C567.665 20.0455 567.851 19.9318 568.007 19.7812C568.164 19.6278 568.284 19.4375 568.369 19.2102L569.341 19.483C569.239 19.8125 569.067 20.1023 568.825 20.3523C568.584 20.5994 568.286 20.7926 567.931 20.9318C567.575 21.0682 567.176 21.1364 566.733 21.1364ZM570.973 21V14.4545H571.945V15.4432H572.013C572.132 15.1193 572.348 14.8565 572.661 14.6548C572.973 14.4531 573.325 14.3523 573.718 14.3523C573.791 14.3523 573.884 14.3537 573.994 14.3565C574.105 14.3594 574.189 14.3636 574.246 14.3693V15.392C574.212 15.3835 574.134 15.3707 574.012 15.3537C573.892 15.3338 573.766 15.3239 573.632 15.3239C573.314 15.3239 573.03 15.3906 572.78 15.5241C572.533 15.6548 572.337 15.8366 572.192 16.0696C572.05 16.2997 571.979 16.5625 571.979 16.858V21H570.973ZM580.074 15.9205L579.171 16.1761C579.114 16.0256 579.03 15.8793 578.92 15.7372C578.812 15.5923 578.664 15.473 578.476 15.3793C578.289 15.2855 578.049 15.2386 577.756 15.2386C577.356 15.2386 577.022 15.331 576.755 15.5156C576.491 15.6974 576.358 15.929 576.358 16.2102C576.358 16.4602 576.449 16.6577 576.631 16.8026C576.813 16.9474 577.097 17.0682 577.483 17.1648L578.455 17.4034C579.04 17.5455 579.476 17.7628 579.763 18.0554C580.05 18.3452 580.194 18.7187 580.194 19.1761C580.194 19.5511 580.086 19.8864 579.87 20.1818C579.657 20.4773 579.358 20.7102 578.975 20.8807C578.591 21.0511 578.145 21.1364 577.637 21.1364C576.969 21.1364 576.417 20.9915 575.979 20.7017C575.542 20.4119 575.265 19.9886 575.148 19.4318L576.103 19.1932C576.194 19.5455 576.366 19.8097 576.618 19.9858C576.874 20.1619 577.208 20.25 577.62 20.25C578.089 20.25 578.461 20.1506 578.736 19.9517C579.015 19.75 579.154 19.5085 579.154 19.2273C579.154 19 579.074 18.8097 578.915 18.6562C578.756 18.5 578.512 18.3835 578.182 18.3068L577.091 18.0511C576.492 17.9091 576.052 17.6889 575.77 17.3906C575.492 17.0895 575.353 16.7131 575.353 16.2614C575.353 15.892 575.456 15.5653 575.664 15.2812C575.874 14.9972 576.16 14.7741 576.52 14.6122C576.884 14.4503 577.296 14.3693 577.756 14.3693C578.404 14.3693 578.912 14.5114 579.282 14.7955C579.654 15.0795 579.918 15.4545 580.074 15.9205Z"
          fill="white"
        />
      </g>
      <defs>
        <linearGradient
          id="paint0_linear_1109_720"
          x1="3"
          y1="12.577"
          x2="140"
          y2="12.577"
          gradientUnits="userSpaceOnUse"
        >
          <stop stopColor="#304258" />
          <stop offset="1" stopColor="#142130" />
        </linearGradient>
        <linearGradient
          id="paint1_linear_1109_720"
          x1="3"
          y1="36.577"
          x2="68"
          y2="36.577"
          gradientUnits="userSpaceOnUse"
        >
          <stop stopColor="#304258" />
          <stop offset="1" stopColor="#142130" />
        </linearGradient>
        <clipPath id="clip0_1109_720">
          <rect width="595" height="169" rx="10.8972" fill="white" />
        </clipPath>
      </defs>
    </svg>
  );
}
